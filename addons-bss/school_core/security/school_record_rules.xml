<odoo>
    <!-- Student can only see their own record -->
    <record id="rule_student_only_own" model="ir.rule">
        <field name="name">Student: only own student</field>
        <field name="model_id" ref="school_core.model_school_student"/>
        <field name="domain_force">[('user_id','=',user.id)]</field>
        <field name="groups" eval="[(4, ref('school_core.group_school_student'))]"/>
    </record>

    <!-- Admin has full access to all students -->
    <record id="rule_admin_all_students" model="ir.rule">
        <field name="name">Admin: full access to students</field>
        <field name="model_id" ref="school_core.model_school_student"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="groups" eval="[(4, ref('school_core.group_school_admin'))]"/>
    </record>

    <!-- Teacher can only see their own subjects -->
    <record id="rule_teacher_subjects" model="ir.rule">
        <field name="name">Teacher: only own subjects</field>
        <field name="model_id" ref="school_core.model_school_subject"/>
        <field name="domain_force">[('teacher_id.user_id','=',user.id)]</field>
        <field name="groups" eval="[(4, ref('school_core.group_school_teacher'))]"/>
    </record>

    <!-- Admin has full access to all subjects -->
    <record id="rule_admin_all_subjects" model="ir.rule">
        <field name="name">Admin: full access to subjects</field>
        <field name="model_id" ref="school_core.model_school_subject"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="groups" eval="[(4, ref('school_core.group_school_admin'))]"/>
    </record>

    <!-- Teacher can see enrollments of their subjects -->
    <record id="rule_teacher_enrollments" model="ir.rule">
        <field name="name">Teacher: see enrollments of own subjects</field>
        <field name="model_id" ref="school_core.model_school_enrollment"/>
        <field name="domain_force">[('subject_id.teacher_id.user_id','=',user.id)]</field>
        <field name="groups" eval="[(4, ref('school_core.group_school_teacher'))]"/>
    </record>

    <!-- Admin has full access to all enrollments -->
    <record id="rule_admin_all_enrollments" model="ir.rule">
        <field name="name">Admin: full access to enrollments</field>
        <field name="model_id" ref="school_core.model_school_enrollment"/>
        <field name="domain_force">[(1,'=',1)]</field>
        <field name="groups" eval="[(4, ref('school_core.group_school_admin'))]"/>
    </record>

    <!-- Teacher can see students enrolled in their subjects (via enrollment_ids relation) -->
    <record id="rule_teacher_students" model="ir.rule">
        <field name="name">Teacher: only students of own subjects</field>
        <field name="model_id" ref="school_core.model_school_student"/>
        <field name="domain_force">[('enrollment_ids.subject_id.teacher_id.user_id','=',user.id)]</field>
        <field name="groups" eval="[(4, ref('school_core.group_school_teacher'))]"/>
    </record>
</odoo>
